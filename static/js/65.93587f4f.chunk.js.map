{"version":3,"file":"static/js/65.93587f4f.chunk.js","mappings":"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","sources":["raven/worker.ts","../webpack/bootstrap","../webpack/runtime/chunk loaded","../webpack/runtime/define property getters","../webpack/runtime/ensure chunk","../webpack/runtime/get javascript chunk filename","../webpack/runtime/get mini-css chunk filename","../webpack/runtime/hasOwnProperty shorthand","../webpack/runtime/make namespace object","../webpack/runtime/publicPath","../webpack/runtime/importScripts chunk loading","../webpack/runtime/startup chunk dependencies","../webpack/startup"],"sourcesContent":["import * as Comlink from 'comlink';\nimport {Event, Filter, SimplePool, Sub} from 'nostr-tools';\n\nexport class BgRaven {\n    private seenOn: Record<string, string[]> = {};\n    private subs: Record<string, Sub> = {};\n    private relays: string[] = [];\n    private pool = new SimplePool();\n    private poolCreated = Date.now();\n\n    public setup(relays: string[]) {\n        this.relays = relays;\n    }\n\n    private getPool = (): SimplePool => {\n        if (Date.now() - this.poolCreated > 120000) {\n            // renew pool every two minutes\n            this.pool.close(this.relays);\n\n            this.pool = new SimplePool();\n            this.poolCreated = Date.now();\n        }\n\n        return this.pool;\n    }\n\n    public fetch(filters: Filter[], quitMs: number = 0): Promise<Event[]> {\n        return new Promise((resolve) => {\n            const pool = this.getPool();\n            const sub = pool.sub(this.relays, filters);\n            const events: Event[] = [];\n\n            const quit = () => {\n                sub.unsub();\n                resolve(events);\n            }\n\n            let timer: any = quitMs > 0 ? setTimeout(quit, quitMs) : null;\n\n            sub.on('event', (event: Event) => {\n                events.push(event);\n                this.seenOn[event.id] = pool.seenOn(event.id);\n\n                if (quitMs > 0) {\n                    clearTimeout(timer);\n                    timer = setTimeout(quit, quitMs);\n                }\n            });\n\n            if (quitMs === 0) {\n                sub.on('eose', () => {\n                    sub.unsub();\n                    resolve(events);\n                });\n            }\n        });\n    }\n\n    public sub(filters: Filter[], onEvent: (e: Event) => void, unsub: boolean = true) {\n        const subId = Math.random().toString().slice(2);\n        const pool = this.getPool();\n        const sub = pool.sub(this.relays, filters, {id: subId});\n\n        sub.on('event', (event) => {\n            this.seenOn[event.id] = pool.seenOn(event.id);\n            onEvent(event)\n        });\n\n        sub.on('eose', () => {\n            if (unsub) {\n                this.unsub(subId);\n            }\n        });\n\n        this.subs[subId] = sub;\n        return subId;\n    }\n\n    public unsub(subId: string) {\n        if (this.subs[subId]) {\n            this.subs[subId].unsub();\n            delete this.subs[subId];\n        }\n    }\n\n    public async where(eventId: string) {\n        let try_ = 0;\n        while (!this.seenOn[eventId]) {\n            await this.fetch([{ids: [eventId]}]);\n            try_++;\n            if (try_ === 3) {\n                break;\n            }\n        }\n\n        if (!this.seenOn[eventId]) {\n            throw new Error('Could not find root event');\n        }\n\n        return this.findHealthyRelay(this.seenOn[eventId]);\n    }\n\n    private async findHealthyRelay(relays: string[]) {\n        const pool = this.getPool();\n        for (const relay of relays) {\n            try {\n                await pool.ensureRelay(relay);\n                return relay;\n            } catch (e) {\n            }\n        }\n\n        throw new Error(\"Couldn't find a working relay\");\n    }\n}\n\nComlink.expose(new BgRaven());\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [16], () => (__webpack_require__(1065)))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"static/js/\" + chunkId + \".\" + \"a3d69fa2\" + \".chunk.js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"/\";","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t65: 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = globalThis[\"webpackChunkangor_chat\"] = globalThis[\"webpackChunkangor_chat\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn __webpack_require__.e(16).then(next);\n};","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["Comlink","constructor","seenOn","subs","relays","pool","SimplePool","poolCreated","Date","now","getPool","this","close","setup","fetch","filters","quitMs","arguments","length","undefined","Promise","resolve","sub","events","quit","unsub","timer","setTimeout","on","event","push","id","clearTimeout","onEvent","subId","Math","random","toString","slice","eventId","try_","ids","Error","findHealthyRelay","relay","ensureRelay","e","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","m","x","__webpack_exports__","O","deferred","result","chunkIds","fn","priority","notFulfilled","Infinity","i","fulfilled","j","Object","keys","every","key","splice","r","d","definition","o","defineProperty","enumerable","get","f","chunkId","all","reduce","promises","u","miniCssF","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","p","installedChunks","importScripts","chunkLoadingGlobal","globalThis","parentChunkLoadingFunction","bind","data","moreModules","runtime","pop","next","then"],"sourceRoot":""}